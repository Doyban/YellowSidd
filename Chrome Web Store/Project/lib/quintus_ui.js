var quintusUI=function(t){"use strict";t.UI=function(i){if(i._isUndefined(t.Touch))throw"Quintus.UI requires Quintus.Touch Module";i.UI={},i.UI.roundRect=function(t,i){t.beginPath(),t.moveTo(-i.cx+i.radius,-i.cy),t.lineTo(-i.cx+i.w-i.radius,-i.cy),t.quadraticCurveTo(-i.cx+i.w,-i.cy,-i.cx+i.w,-i.cy+i.radius),t.lineTo(-i.cx+i.w,-i.cy+i.h-i.radius),t.quadraticCurveTo(-i.cx+i.w,-i.cy+i.h,-i.cx+i.w-i.radius,-i.cy+i.h),t.lineTo(-i.cx+i.radius,-i.cy+i.h),t.quadraticCurveTo(-i.cx,-i.cy+i.h,-i.cx,-i.cy+i.h-i.radius),t.lineTo(-i.cx,-i.cy+i.radius),t.quadraticCurveTo(-i.cx,-i.cy,-i.cx+i.radius,-i.cy),t.closePath()},i.UI.Container=i.Sprite.extend("UI.Container",{init:function(t,e){var s,h=i._clone(t||{});t&&i._isString(t.w)&&(s=t.w.match(/^[0-9]+%$/))&&(h.w=parseInt(t.w,10)*i.width/100,h.x=i.width/2-h.w/2),t&&i._isString(t.h)&&(s=t.h.match(/^[0-9]+%$/))&&(h.h=parseInt(t.h,10)*i.height/100,h.y=i.height/2-h.h/2),this._super(i._defaults(h,e),{opacity:1,hidden:!1,fill:null,highlight:null,radius:5,stroke:"#000",border:!1,shadow:!1,shadowColor:!1,outlineWidth:!1,outlineColor:"#000",type:i.SPRITE_NONE})},insert:function(t){return this.stage.insert(t,this),t},fit:function(t,e){if(0!==this.children.length){void 0===t&&(t=0),void 0===e&&(e=t);for(var s=1/0,h=1/0,n=-(1/0),o=-(1/0),r=0;r<this.children.length;r++){var l=this.children[r],a=l.p.x-l.p.cx,p=l.p.y-l.p.cy,c=l.p.x-l.p.cx+l.p.w,d=l.p.y-l.p.cy+l.p.h;s>a&&(s=a),h>p&&(h=p),c>n&&(n=c),d>o&&(o=d)}this.p.cx=-s+e,this.p.cy=-h+t,this.p.w=n-s+2*e,this.p.h=o-h+2*t,i._generatePoints(this,!0),i._generateCollisionPoints(this,!0)}},addShadow:function(t){if(this.p.shadow){var e=i._isNumber(this.p.shadow)?this.p.shadow:5;t.shadowOffsetX=e,t.shadowOffsetY=e,t.shadowColor=this.p.shadowColor||"rgba(0,0,50,0.1)"}},clearShadow:function(t){t.shadowColor="transparent"},drawRadius:function(t){i.UI.roundRect(t,this.p),this.addShadow(t),t.fill(),this.p.border&&(this.clearShadow(t),t.lineWidth=this.p.border,t.stroke())},drawSquare:function(t){this.addShadow(t),this.p.fill&&t.fillRect(-this.p.cx,-this.p.cy,this.p.w,this.p.h),this.p.border&&(this.clearShadow(t),t.lineWidth=this.p.border,t.strokeRect(-this.p.cx,-this.p.cy,this.p.w,this.p.h))},draw:function(t){return this.p.hidden?!1:void((this.p.border||this.p.fill)&&(t.globalAlpha=this.p.opacity,1===this.p.frame&&this.p.highlight?t.fillStyle=this.p.highlight:t.fillStyle=this.p.fill,t.strokeStyle=this.p.stroke,this.p.radius>0?this.drawRadius(t):this.drawSquare(t)))}}),i.UI.Text=i.Sprite.extend("UI.Text",{init:function(t,e){this._super(i._defaults(t||{},e),{type:i.SPRITE_UI,size:24,lineHeight:1.2,align:"center"}),this.p.label&&this.calcSize()},calcSize:function(){var t=this.p;this.setFont(i.ctx),this.splitLabel=t.label.split("\n");t.w=0;for(var e=0;e<this.splitLabel.length;e++){var s=i.ctx.measureText(this.splitLabel[e]);s.width>t.w&&(t.w=s.width)}t.lineHeightPx=t.size*t.lineHeight,t.h=t.lineHeightPx*this.splitLabel.length,t.halfLeading=.5*t.size*Math.max(0,t.lineHeight-1),t.cy=0,"center"===t.align?(t.cx=t.w/2,t.points=[[-t.cx,0],[t.cx,0],[t.cx,t.h],[-t.cx,t.h]]):"right"===t.align?(t.cx=t.w,t.points=[[-t.w,0],[0,0],[0,t.h],[-t.w,t.h]]):(t.cx=0,t.points=[[0,0],[t.w,0],[t.w,t.h],[0,t.h]])},prerender:function(){this.p.oldLabel!==this.p.label&&(this.p.oldLabel=this.p.label,this.calcSize(),this.el.width=this.p.w,this.el.height=4*this.p.h,this.ctx.clearRect(0,0,this.p.w,this.p.h),this.ctx.fillStyle="#FF0",this.ctx.fillRect(0,0,this.p.w,this.p.h/2),this.setFont(this.ctx),this.ctx.fillText(this.p.label,0,0))},draw:function(t){var i=this.p;if(0!==i.opacity){i.oldLabel!==i.label&&this.calcSize(),this.setFont(t),void 0!==i.opacity&&(t.globalAlpha=i.opacity);for(var e=0;e<this.splitLabel.length;e++)i.outlineWidth&&t.strokeText(this.splitLabel[e],0,i.halfLeading+e*i.lineHeightPx),t.fillText(this.splitLabel[e],0,i.halfLeading+e*i.lineHeightPx)}},asset:function(){return this.el},setFont:function(t){t.textBaseline="top",t.font=this.font(),t.fillStyle=this.p.color||"black",t.textAlign=this.p.align||"left",t.strokeStyle=this.p.outlineColor||"black",t.lineWidth=this.p.outlineWidth||0},font:function(){return this.fontString?this.fontString:(this.fontString=(this.p.weight||"800")+" "+(this.p.size||24)+"px "+(this.p.family||"Arial"),this.fontString)}}),i.UI.Button=i.UI.Container.extend("UI.Button",{init:function(t,e,s){if(this._super(i._defaults(t||{},s),{type:i.SPRITE_UI|i.SPRITE_DEFAULT,keyActionName:null}),this.p.label&&(!this.p.w||!this.p.h)){i.ctx.save(),this.setFont(i.ctx);var h=i.ctx.measureText(this.p.label);i.ctx.restore(),this.p.h||(this.p.h=44),this.p.w||(this.p.w=h.width+20)}isNaN(this.p.cx)&&(this.p.cx=this.p.w/2),isNaN(this.p.cy)&&(this.p.cy=this.p.h/2),this.callback=e,this.on("touch",this,"highlight"),this.on("touchEnd",this,"push"),this.p.keyActionName&&i.input.on(this.p.keyActionName,this,"push")},highlight:function(){"undefined"!=typeof this.sheet()&&this.sheet().frames>1&&(this.p.frame=1)},push:function(){this.p.frame=0,this.callback&&this.callback(),this.trigger("click")},draw:function(t){this._super(t),(this.p.asset||this.p.sheet)&&i.Sprite.prototype.draw.call(this,t),this.p.label&&(t.save(),this.setFont(t),t.fillText(this.p.label,0,0),t.restore())},setFont:function(t){t.textBaseline="middle",t.font=this.p.font||"400 24px arial",t.fillStyle=this.p.fontColor||"black",t.textAlign="center"}}),i.UI.IFrame=i.Sprite.extend("UI.IFrame",{init:function(t){this._super(t,{opacity:1,type:i.SPRITE_UI|i.SPRITE_DEFAULT}),i.wrapper.style.overflow="hidden",this.iframe=document.createElement("IFRAME"),this.iframe.setAttribute("src",this.p.url),this.iframe.style.position="absolute",this.iframe.style.zIndex=500,this.iframe.setAttribute("width",this.p.w),this.iframe.setAttribute("height",this.p.h),this.iframe.setAttribute("frameborder",0),this.p.background&&(this.iframe.style.backgroundColor=this.p.background),i.wrapper.appendChild(this.iframe),this.on("inserted",function(t){this.positionIFrame(),t.on("destroyed",this,"remove")})},positionIFrame:function(){var t=this.p.x,i=this.p.y;this.stage.viewport&&(t-=this.stage.viewport.x,i-=this.stage.viewport.y),(this.oldX!==t||this.oldY!==i||this.oldOpacity!==this.p.opacity)&&(this.iframe.style.top=i-this.p.cy+"px",this.iframe.style.left=t-this.p.cx+"px",this.iframe.style.opacity=this.p.opacity,this.oldX=t,this.oldY=i,this.oldOpacity=this.p.opacity)},step:function(t){this._super(t),this.positionIFrame()},remove:function(){this.iframe&&(i.wrapper.removeChild(this.iframe),this.iframe=null)}}),i.UI.HTMLElement=i.Sprite.extend("UI.HTMLElement",{init:function(t){this._super(t,{opacity:1,type:i.SPRITE_UI}),i.wrapper.style.overflow="hidden",this.el=document.createElement("div"),this.el.innerHTML=this.p.html,i.wrapper.appendChild(this.el),this.on("inserted",function(t){this.position(),t.on("destroyed",this,"remove"),t.on("clear",this,"remove")})},position:function(){},step:function(t){this._super(t),this.position()},remove:function(){this.el&&(i.wrapper.removeChild(this.el),this.el=null)}}),i.UI.VerticalLayout=i.Sprite.extend("UI.VerticalLayout",{init:function(t){this.children=[],this._super(t,{type:0})},insert:function(t){return this.stage.insert(t,this),this.relayout(),t},relayout:function(){for(var t=0,i=0;i<this.children.length;i++)t+=this.children[i].p.h||0;this.p.h-t}})}};"undefined"==typeof Quintus?module.exports=quintusUI:quintusUI(Quintus);