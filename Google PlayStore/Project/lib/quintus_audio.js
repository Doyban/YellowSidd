var quintusAudio=function(n){"use strict";n.Audio=function(n){n.audio={channels:[],channelMax:n.options.channelMax||10,active:{},play:function(){}},n.hasWebAudio="undefined"!=typeof AudioContext||"undefined"!=typeof webkitAudioContext,n.hasWebAudio&&("undefined"!=typeof AudioContext?n.audioContext=new AudioContext:n.audioContext=new window.webkitAudioContext),n.enableSound=function(){"undefined"!=typeof window&&!!("ontouchstart"in window);return n.hasWebAudio?n.audio.enableWebAudioSound():n.audio.enableHTML5Sound(),n},n.audio.enableWebAudioSound=function(){n.audio.type="WebAudio",n.audio.soundID=0,n.audio.playingSounds={},n.audio.removeSound=function(o){delete n.audio.playingSounds[o]},n.audio.play=function(o,e){var a=(new Date).getTime();if(!(n.audio.active[o]&&n.audio.active[o]>a)){e&&e.debounce?n.audio.active[o]=a+e.debounce:delete n.audio.active[o];var i=n.audio.soundID++,u=n.audioContext.createBufferSource();u.buffer=n.asset(o),u.connect(n.audioContext.destination),e&&e.loop?u.loop=!0:setTimeout(function(){n.audio.removeSound(i)},1e3*u.buffer.duration),u.assetName=o,u.start?u.start(0):u.noteOn(0),n.audio.playingSounds[i]=u}},n.audio.stop=function(o){for(var e in n.audio.playingSounds){var a=n.audio.playingSounds[e];o&&o!==a.assetName||(a.stop?a.stop(0):a.noteOff(0))}}},n.audio.enableHTML5Sound=function(){n.audio.type="HTML5";for(var o=0;o<n.audio.channelMax;o++)n.audio.channels[o]={},n.audio.channels[o].channel=new Audio,n.audio.channels[o].finished=-1;n.audio.play=function(o,e){var a=(new Date).getTime();if(!(n.audio.active[o]&&n.audio.active[o]>a)){e&&e.debounce?n.audio.active[o]=a+e.debounce:delete n.audio.active[o];for(var i=0;i<n.audio.channels.length;i++)if(!n.audio.channels[i].loop&&n.audio.channels[i].finished<a){n.audio.channels[i].channel.src=n.asset(o).src,e&&e.loop?(n.audio.channels[i].loop=!0,n.audio.channels[i].channel.loop=!0):n.audio.channels[i].finished=a+1e3*n.asset(o).duration,n.audio.channels[i].channel.load(),n.audio.channels[i].channel.play();break}}},n.audio.stop=function(o){for(var e=o?n.asset(o).src:null,a=(new Date).getTime(),i=0;i<n.audio.channels.length;i++)e&&n.audio.channels[i].channel.src!==e||!(n.audio.channels[i].loop||n.audio.channels[i].finished>=a)||(n.audio.channels[i].channel.pause(),n.audio.channels[i].loop=!1)}}}};"undefined"==typeof Quintus?module.exports=quintusAudio:quintusAudio(Quintus);