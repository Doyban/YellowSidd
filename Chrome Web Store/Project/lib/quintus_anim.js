var quintusAnim=function(t){"use strict";t.Anim=function(t){t._animations={},t.animations=function(i,e){t._animations[i]||(t._animations[i]={}),t._extend(t._animations[i],e)},t.animation=function(i,e){return t._animations[i]&&t._animations[i][e]},t.component("animation",{added:function(){var t=this.entity.p;t.animation=null,t.animationPriority=-1,t.animationFrame=0,t.animationTime=0,this.entity.on("step",this,"step")},extend:{play:function(t,i,e){this.animation.play(t,i,e)}},step:function(i){var e=this.entity,n=e.p;if(n.animation){var a=t.animation(n.sprite,n.animation),s=a.rate||n.rate,r=0;if(n.animationTime+=i,n.animationChanged?n.animationChanged=!1:n.animationTime>s&&(r=Math.floor(n.animationTime/s),n.animationTime-=r*s,n.animationFrame+=r),r>0){if(n.animationFrame>=a.frames.length){if(a.loop===!1||a.next)return n.animationFrame=a.frames.length-1,e.trigger("animEnd"),e.trigger("animEnd."+n.animation),n.animation=null,n.animationPriority=-1,a.trigger&&e.trigger(a.trigger,a.triggerData),void(a.next&&this.play(a.next,a.nextPriority));e.trigger("animLoop"),e.trigger("animLoop."+n.animation),n.animationFrame=n.animationFrame%a.frames.length}e.trigger("animFrame")}n.sheet=a.sheet||n.sheet,n.frame=a.frames[n.animationFrame],a.hasOwnProperty("flip")&&(n.flip=a.flip)}},play:function(t,i,e){var n=this.entity,a=n.p;i=i||0,t!==a.animation&&i>=a.animationPriority&&(void 0===e&&(e=!0),a.animation=t,e&&(a.animationChanged=!0,a.animationTime=0,a.animationFrame=0),a.animationPriority=i,n.trigger("anim"),n.trigger("anim."+a.animation))}}),t.Sprite.extend("Repeater",{init:function(i){this._super(t._defaults(i,{speedX:1,speedY:1,repeatY:!0,repeatX:!0,renderAlways:!0,type:0})),this.p.repeatW=this.p.repeatW||this.p.w,this.p.repeatH=this.p.repeatH||this.p.h},draw:function(i){var e,n,a,s,r,o=this.p,h=this.asset(),p=this.sheet(),m=this.stage.viewport?this.stage.viewport.scale:1,f=Math.floor(this.stage.viewport?this.stage.viewport.x:0),u=Math.floor(this.stage.viewport?this.stage.viewport.y:0),d=Math.floor(o.x+f*this.p.speedX),g=Math.floor(o.y+u*this.p.speedY);for(o.repeatX?(e=-d%o.repeatW,e>0&&(e-=o.repeatW)):e=o.x-f,o.repeatY?(n=-g%o.repeatH,n>0&&(n-=o.repeatH)):n=o.y-u,a=e,s=t.width/Math.abs(m)/Math.abs(o.scale||1)+o.repeatW,r=t.height/Math.abs(m)/Math.abs(o.scale||1)+o.repeatH;r>n;){for(e=a;s>e&&(p?p.draw(i,e+f,n+u,o.frame):i.drawImage(h,e+f,n+u),e+=o.repeatW,o.repeatX););if(n+=o.repeatH,!o.repeatY)break}}}),t.Tween=t.Class.extend({init:function(i,e,n,a,s){t._isObject(a)&&(s=a,a=t.Easing.Linear),t._isObject(n)&&(s=n,n=1),this.entity=i,this.duration=n||1,this.time=0,this.options=s||{},this.delay=this.options.delay||0,this.easing=a||this.options.easing||t.Easing.Linear,this.startFrame=t._loopFrame+1,this.properties=e,this.start={},this.diff={}},step:function(i){var e;if(this.startFrame>t._loopFrame)return!0;if(this.delay>=i)return this.delay-=i,!0;if(this.delay>0&&(i-=this.delay,this.delay=0),0===this.time){var n=this.entity,a=this.properties;this.p=n instanceof t.Stage?n.viewport:n.p;for(e in a)this.start[e]=this.p[e],t._isUndefined(this.start[e])||(this.diff[e]=a[e]-this.start[e])}this.time+=i;var s=Math.min(1,this.time/this.duration),r=this.easing(s);for(e in this.start)t._isUndefined(this.p[e])||(this.p[e]=this.start[e]+this.diff[e]*r);return s>=1&&this.options.callback&&this.options.callback.apply(this.entity),1>s}}),t.Easing={Linear:function(t){return t},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}}},t.component("tween",{added:function(){this._tweens=[],this.entity.on("step",this,"step")},extend:{animate:function(i,e,n,a){return this.tween._tweens.push(new t.Tween(this,i,e,n,a)),this},chain:function(i,e,n,a){t._isObject(n)&&(a=n,n=t.Easing.Linear);var s=this.tween._tweens.length;if(s>0){var r=this.tween._tweens[s-1];a=a||{},a.delay=r.duration-r.time+r.delay}return this.animate(i,e,n,a),this},stop:function(){return this.tween._tweens.length=0,this}},step:function(t){for(var i=0;i<this._tweens.length;i++)this._tweens[i].step(t)||(this._tweens.splice(i,1),i--)}})}};"undefined"==typeof Quintus?module.exports=quintusAnim:quintusAnim(Quintus);