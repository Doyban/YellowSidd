var quintusCore=function(t,e){"use strict";var n=t[e]=function(e){var i=function(t,e,n){return i.select(t,e,n)};i.select=function(){},i.include=function(t){return i._each(i._normalizeArg(t),function(t){var e=n[t]||t;if(!i._isFunction(e))throw"Invalid Module:"+t;e(i)}),i},i._normalizeArg=function(t){return i._isString(t)&&(t=t.replace(/\s+/g,"").split(",")),i._isArray(t)||(t=[t]),t},i._extend=function(t,e){if(!e)return t;for(var n in e)t[n]=e[n];return t},i._clone=function(t){return i._extend({},t)},i._defaults=function(t,e){if(!e)return t;for(var n in e)void 0===t[n]&&(t[n]=e[n]);return t},i._has=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i._isString=function(t){return"string"==typeof t},i._isNumber=function(t){return"[object Number]"===Object.prototype.toString.call(t)},i._isFunction=function(t){return"[object Function]"===Object.prototype.toString.call(t)},i._isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},i._isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},i._isUndefined=function(t){return void 0===t},i._popProperty=function(t,e){var n=t[e];return delete t[e],n},i._each=function(t,e,n){if(null!=t)if(t.forEach)t.forEach(e,n);else if(t.length===+t.length)for(var i=0,r=t.length;r>i;i++)e.call(n,t[i],i,t);else for(var o in t)e.call(n,t[o],o,t)},i._invoke=function(t,e,n,i){if(null!==t)for(var r=0,o=t.length;o>r;r++)t[r][e](n,i)},i._detect=function(t,e,n,i,r){var o;if(null!==t){if(t.length===+t.length){for(var s=0,a=t.length;a>s;s++)if(o=e.call(n,t[s],s,i,r))return o;return!1}for(var u in t)if(o=e.call(n,t[u],u,i,r))return o;return!1}},i._map=function(t,e,n){var r=[];return null===t?r:t.map?t.map(e,n):(i._each(t,function(t,i,o){r[r.length]=e.call(n,t,i,o)}),t.length===+t.length&&(r.length=t.length),r)},i._uniq=function(t){t=t.slice().sort();for(var e=[],n=null,i=0;i<t.length;i++)void 0!==t[i]&&n!==t[i]&&e.push(t[i]),n=t[i];return e},i._shuffle=function(t){var e,n=[];return i._each(t,function(t,i,r){e=Math.floor(Math.random()*(i+1)),n[i]=n[e],n[e]=t}),n},i._keys=Object.keys||function(t){if(i._isObject(t))throw new TypeError("Invalid object");var e=[];for(var n in t)i._has(t,n)&&(e[e.length]=n);return e},i._range=function(t,e,n){n=n||1;for(var i=Math.max(Math.ceil((e-t)/n),0),r=0,o=new Array(i);i>r;)o[r++]=t,t+=n;return o};var r=0;return i._uniqueId=function(){return r++},i.options={imagePath:"images/",audioPath:"audio/",dataPath:"data/",audioSupported:["mp3","ogg"],sound:!0,frameTimeLimit:100,autoFocus:!0},e&&i._extend(i.options,e),i.scheduleFrame=function(e){return t.requestAnimationFrame(e)},i.cancelFrame=function(e){t.cancelAnimationFrame(e)},i.gameLoop=function(t){return i.lastGameLoopFrame=(new Date).getTime(),i.loop=!0,i._loopFrame=0,i.gameLoopCallbackWrapper=function(){var e=(new Date).getTime();i._loopFrame++,i.loop=i.scheduleFrame(i.gameLoopCallbackWrapper);var n=e-i.lastGameLoopFrame;n>i.options.frameTimeLimit&&(n=i.options.frameTimeLimit),t.apply(i,[n/1e3]),i.lastGameLoopFrame=e},i.scheduleFrame(i.gameLoopCallbackWrapper),i},i.pauseGame=function(){i.loop&&i.cancelFrame(i.loop),i.loop=null},i.unpauseGame=function(){i.loop||(i.lastGameLoopFrame=(new Date).getTime(),i.loop=i.scheduleFrame(i.gameLoopCallbackWrapper))},function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;i.Class=function(){},i.Class.prototype.isA=function(t){return this.className===t},i.Class.extend=function(n,r,o){function s(t,e){return function(){var n=this._super;this._super=u[t];var i=e.apply(this,arguments);return this._super=n,i}}function a(){!t&&this.init&&this.init.apply(this,arguments)}i._isString(n)||(o=r,r=n,n=null);var u=this.prototype,l=this;t=!0;var h=new l;t=!1;for(var c in r)h[c]="function"==typeof r[c]&&"function"==typeof u[c]&&e.test(r[c])?s(c,r[c]):r[c];return a.prototype=h,a.prototype.constructor=a,a.extend=i.Class.extend,o&&i._extend(a,o),n&&(i[n]=a,a.prototype.className=n,a.className=n),a}}(),i.Class.extend("Evented",{on:function(t,e,n){if(i._isArray(t)||-1!==t.indexOf(",")){t=i._normalizeArg(t);for(var r=0;r<t.length;r++)this.on(t[r],e,n)}else n||(n=e,e=null),n||(n=t),i._isString(n)&&(n=(e||this)[n]),this.listeners=this.listeners||{},this.listeners[t]=this.listeners[t]||[],this.listeners[t].push([e||this,n]),e&&(e.binds||(e.binds=[]),e.binds.push([this,t,n]))},trigger:function(t,e){if(this.listeners&&this.listeners[t])for(var n=0,i=this.listeners[t].length;i>n;n++){var r=this.listeners[t][n];r[1].call(r[0],e)}},off:function(t,e,n){if(e){i._isString(n)&&e[n]&&(n=e[n]);var r=this.listeners&&this.listeners[t];if(r)for(var o=r.length-1;o>=0;o--)r[o][0]===e&&(n&&n!==r[o][1]||this.listeners[t].splice(o,1))}else this.listeners[t]&&delete this.listeners[t]},debind:function(){if(this.binds)for(var t=0,e=this.binds.length;e>t;t++){var n=this.binds[t],i=n[0],r=n[1];i.off(r,this)}}}),i.components={},i.Evented.extend("Component",{init:function(t){this.entity=t,this.extend&&i._extend(t,this.extend),t[this.name]=this,t.activeComponents.push(this.componentName),t.stage&&t.stage.addToList&&t.stage.addToList(this.componentName,t),this.added&&this.added()},destroy:function(){if(this.extend)for(var t=i._keys(this.extend),e=0,n=t.length;n>e;e++)delete this.entity[t[e]];delete this.entity[this.name];var r=this.entity.activeComponents.indexOf(this.componentName);-1!==r&&(this.entity.activeComponents.splice(r,1),this.entity.stage&&this.entity.stage.addToList&&this.entity.stage.addToLists(this.componentName,this.entity)),this.debind(),this.destroyed&&this.destroyed()}}),i.Evented.extend("GameObject",{has:function(t){return this[t]?!0:!1},add:function(t){t=i._normalizeArg(t),this.activeComponents||(this.activeComponents=[]);for(var e=0,n=t.length;n>e;e++){var r=t[e],o=i.components[r];if(!this.has(r)&&o){var s=new o(this);this.trigger("addComponent",s)}}return this},del:function(t){t=i._normalizeArg(t);for(var e=0,n=t.length;n>e;e++){var r=t[e];r&&this.has(r)&&(this.trigger("delComponent",this[r]),this[r].destroy())}return this},destroy:function(){this.isDestroyed||(this.trigger("destroyed"),this.debind(),this.stage&&this.stage.remove&&this.stage.remove(this),this.isDestroyed=!0,this.destroyed&&this.destroyed())}}),i.component=function(t,e){return e?(e.name=t,e.componentName="."+t,i.components[t]=i.Component.extend(t+"Component",e)):i.components[t]},i.GameObject.extend("GameState",{init:function(t){this.p=i._extend({},t),this.listeners={}},reset:function(t){this.init(t),this.trigger("reset")},_triggerProperty:function(t,e){this.p[e]!==t&&(this.p[e]=t,this.trigger("change."+e,t))},set:function(t,e){i._isObject(t)?i._each(t,this._triggerProperty,this):this._triggerProperty(e,t),this.trigger("change")},inc:function(t,e){this.set(t,this.get(t)+e)},dec:function(t,e){this.set(t,this.get(t)-e)},get:function(t){return this.p[t]}}),i.state=new i.GameState,i.reset=function(){i.state.reset()},i.touchDevice="undefined"==typeof exports&&"ontouchstart"in document,i.setup=function(e,n){i._isObject(e)&&(n=e,e=null),n=n||{},e=e||"quintus",i._isString(e)?i.el=document.getElementById(e):i.el=e,i.el||(i.el=document.createElement("canvas"),i.el.width=n.width||320,i.el.height=n.height||420,i.el.id=e,document.body.appendChild(i.el));var r=parseInt(i.el.width,10),o=parseInt(i.el.height,10),s=n.maxWidth||5e3,a=n.maxHeight||5e3,u=n.resampleWidth,l=n.resampleHeight,h=n.upsampleWidth,c=n.upsampleHeight;n.maximize===!0||i.touchDevice&&"touch"===n.maximize?(document.body.style.padding=0,document.body.style.margin=0,r=n.width||Math.min(t.innerWidth,s)-(n.pagescroll?17:0),o=n.height||Math.min(t.innerHeight-5,a),i.touchDevice&&(i.el.style.height=2*o+"px",t.scrollTo(0,1),r=Math.min(t.innerWidth,s),o=Math.min(t.innerHeight,a))):i.touchDevice&&t.scrollTo(0,1),h&&h>=r||c&&c>=o?(i.el.style.height=o+"px",i.el.style.width=r+"px",i.el.width=2*r,i.el.height=2*o):(u&&r>u||l&&o>l)&&i.touchDevice?(i.el.style.height=o+"px",i.el.style.width=r+"px",i.el.width=r/2,i.el.height=o/2):(i.el.style.height=o+"px",i.el.style.width=r+"px",i.el.width=r,i.el.height=o);var d=i.el.parentNode;if(d&&!i.wrapper&&(i.wrapper=document.createElement("div"),i.wrapper.id=i.el.id+"_container",i.wrapper.style.width=r+"px",i.wrapper.style.margin="0 auto",i.wrapper.style.position="relative",d.insertBefore(i.wrapper,i.el),i.wrapper.appendChild(i.el)),i.el.style.position="relative",i.ctx=i.el.getContext&&i.el.getContext("2d"),i.width=parseInt(i.el.width,10),i.height=parseInt(i.el.height,10),i.cssWidth=r,i.cssHeight=o,n.scaleToFit){var m=1,p=t.innerWidth*m,f=t.innerHeight*m,g=p/f,v=i.el.width/i.el.height,y=g>v?f/i.el.height:p/i.el.width,_=i.el.width*y,x=i.el.height*y;if(i.el.style.width=_+"px",i.el.style.height=x+"px",i.el.parentNode&&(i.el.parentNode.style.width=_+"px",i.el.parentNode.style.height=x+"px"),i.cssWidth=parseInt(_,10),i.cssHeight=parseInt(x,10),v>g){var w=(f-x)/2;i.el.style.top=w+"px"}}return t.addEventListener("orientationchange",function(){setTimeout(function(){t.scrollTo(0,1)},0)}),i},i.clear=function(){i.clearColor?(i.ctx.globalAlpha=1,i.ctx.fillStyle=i.clearColor,i.ctx.fillRect(0,0,i.width,i.height)):i.ctx.clearRect(0,0,i.width,i.height)},i.setImageSmoothing=function(t){i.ctx.mozImageSmoothingEnabled=t,i.ctx.webkitImageSmoothingEnabled=t,i.ctx.msImageSmoothingEnabled=t,i.ctx.imageSmoothingEnabled=t},i.imageData=function(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var n=e.getContext("2d");return n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height)},i.assetTypes={png:"Image",jpg:"Image",gif:"Image",jpeg:"Image",ogg:"Audio",wav:"Audio",m4a:"Audio",mp3:"Audio"},i._fileExtension=function(t){var e=t.split("."),n=e[e.length-1].toLowerCase();return n},i.assetType=function(t){var e=i._fileExtension(t),n=i.assetTypes[e];return"Audio"===n&&i.audio&&"WebAudio"===i.audio.type&&(n="WebAudio"),n||"Other"},i.assetUrl=function(t,e){var n="";return i.options.development&&(n=(/\?/.test(e)?"&":"?")+"_t="+(new Date).getTime()),/^https?:\/\//.test(e)||"/"===e[0]?e+n:t+e+n},i.loadAssetImage=function(t,e,n,r){var o=new Image;o.onload=function(){n(t,o)},o.onerror=r,o.src=i.assetUrl(i.options.imagePath,e)},i.audioMimeTypes={mp3:"audio/mpeg",ogg:'audio/ogg; codecs="vorbis"',m4a:"audio/m4a",wav:"audio/wav"},i._audioAssetExtension=function(){if(i._audioAssetPreferredExtension)return i._audioAssetPreferredExtension;var t=new Audio;return i._audioAssetPreferredExtension=i._detect(i.options.audioSupported,function(e){return t.canPlayType(i.audioMimeTypes[e])?e:null})},i.loadAssetAudio=function(t,e,n,r){if(!document.createElement("audio").play||!i.options.sound)return void n(t,null);var o=i._removeExtension(e),s=i._audioAssetExtension(),a=new Audio;return s?(a.addEventListener("error",r),i.touchDevice||a.addEventListener("canplaythrough",function(){n(t,a)}),a.src=i.assetUrl(i.options.audioPath,o+"."+s),a.load(),void(i.touchDevice&&n(t,a))):void n(t,null)},i.loadAssetWebAudio=function(t,e,n,r){var o=new XMLHttpRequest,s=i._removeExtension(e),a=i._audioAssetExtension();o.open("GET",i.assetUrl(i.options.audioPath,s+"."+a),!0),o.responseType="arraybuffer",o.onload=function(){o.response;i.audioContext.decodeAudioData(o.response,function(e){n(t,e)},r)},o.send()},i.loadAssetOther=function(t,e,n,r){var o=new XMLHttpRequest,s=e.split("."),a=s[s.length-1].toLowerCase();return"file://"===document.location.origin||"null"===document.location.origin?(i.fileURLAlert||(i.fileURLAlert=!0,alert("Quintus Error: Loading assets is not supported from file:// urls - please run from a local web-server and try again")),r()):(o.onreadystatechange=function(){4===o.readyState&&(200===o.status?"json"===a?n(t,JSON.parse(o.responseText)):n(t,o.responseText):r())},o.open("GET",i.assetUrl(i.options.dataPath,e),!0),void o.send(null))},i._removeExtension=function(t){return t.replace(/\.(\w{3,4})$/,"")},i.assets={},i.asset=function(t){return i.assets[t]},i.load=function(t,e,n){var r={};n||(n={});var o=n.progressCallback,s=!1,a=function(t){s=!0,(n.errorCallback||function(t){throw"Error Loading: "+t})(t)};i._isString(t)&&(t=i._normalizeArg(t)),i._isArray(t)?i._each(t,function(t){i._isObject(t)?i._extend(r,t):r[t]=t}):r=t;var u=i._keys(r).length,l=u,h=function(t,n,r){s||((!i.assets[t]||r)&&(i.assets[t]=n,l--,o&&o(u-l,u)),0===l&&e&&e.apply(i))};i._each(r,function(t,e){var n=i.assetType(t);i.assets[e]?h(e,i.assets[e],!0):i["loadAsset"+n](e,t,h,function(){a(t)})})},i.preloads=[],i.preload=function(t,e){i._isFunction(t)?(i.load(i._uniq(i.preloads),t,e),i.preloads=[]):i.preloads=i.preloads.concat(t)},i.matrices2d=[],i.matrix2d=function(){return i.matrices2d.length>0?i.matrices2d.pop().identity():new i.Matrix2D},i.Matrix2D=i.Class.extend({init:function(t){t?(this.m=[],this.clone(t)):this.m=[1,0,0,0,1,0]},identity:function(){var t=this.m;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,this},clone:function(t){var e=this.m,n=t.m;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],this},multiply:function(t){var e=this.m,n=t.m,i=e[0]*n[0]+e[1]*n[3],r=e[0]*n[1]+e[1]*n[4],o=e[0]*n[2]+e[1]*n[5]+e[2],s=e[3]*n[0]+e[4]*n[3],a=e[3]*n[1]+e[4]*n[4],u=e[3]*n[2]+e[4]*n[5]+e[5];return e[0]=i,e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=u,this},rotate:function(t){if(0===t)return this;var e=Math.cos(t),n=Math.sin(t),i=this.m,r=i[0]*e+i[1]*n,o=i[0]*-n+i[1]*e,s=i[3]*e+i[4]*n,a=i[3]*-n+i[4]*e;return i[0]=r,i[1]=o,i[3]=s,i[4]=a,this},rotateDeg:function(t){return 0===t?this:this.rotate(Math.PI*t/180)},scale:function(t,e){var n=this.m;return void 0===e&&(e=t),n[0]*=t,n[1]*=e,n[3]*=t,n[4]*=e,this},translate:function(t,e){var n=this.m;return n[2]+=n[0]*t+n[1]*e,n[5]+=n[3]*t+n[4]*e,this},transform:function(t,e){return[t*this.m[0]+e*this.m[1]+this.m[2],t*this.m[3]+e*this.m[4]+this.m[5]]},transformPt:function(t){var e=t.x,n=t.y;return t.x=e*this.m[0]+n*this.m[1]+this.m[2],t.y=e*this.m[3]+n*this.m[4]+this.m[5],t},transformArr:function(t,e){var n=t[0],i=t[1];return e[0]=n*this.m[0]+i*this.m[1]+this.m[2],e[1]=n*this.m[3]+i*this.m[4]+this.m[5],e},transformX:function(t,e){return t*this.m[0]+e*this.m[1]+this.m[2]},transformY:function(t,e){return t*this.m[3]+e*this.m[4]+this.m[5]},release:function(){return i.matrices2d.push(this),null},setContextTransform:function(t){var e=this.m;t.transform(e[0],e[3],e[1],e[4],e[2],e[5])}}),i};return function(){for(var e=0,n=["ms","moz","webkit","o"],i=0;i<n.length&&!t.requestAnimationFrame;++i)t.requestAnimationFrame=t[n[i]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[n[i]+"CancelAnimationFrame"]||t[n[i]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(t,n){var i=(new Date).getTime(),r=Math.max(0,16-(i-e)),o=setTimeout(function(){t(i+r)},r);return e=i+r,o}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}(),n};if("undefined"==typeof exports)quintusCore(this,"Quintus");else var Quintus=quintusCore(module,"exports");